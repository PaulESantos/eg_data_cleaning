<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>secion</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="03-secion_files/libs/clipboard/clipboard.min.js"></script>
<script src="03-secion_files/libs/quarto-html/quarto.js"></script>
<script src="03-secion_files/libs/quarto-html/popper.min.js"></script>
<script src="03-secion_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="03-secion_files/libs/quarto-html/anchor.min.js"></script>
<link href="03-secion_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="03-secion_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="03-secion_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="03-secion_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="03-secion_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="etapa-2-manipulación-de-tus-datos" class="level1">
<h1>Etapa 2 <br> Manipulación de tus datos</h1>
<section id="dónde-estamos-ahora" class="level2">
<h2 class="anchored" data-anchor-id="dónde-estamos-ahora">¿Dónde estamos ahora?</h2>
<ul>
<li>Hemos realizado la DEV (Exploración y Validación de Datos) - con más validación por hacer. La validación de datos es un proceso continuo, hasta llegar al bloqueo de datos.</li>
<li>Discutimos la importancia de prevenir errores de datos en la fuente.</li>
</ul>
</section>
<section id="dónde-estamos-ahora-1" class="level2">
<h2 class="anchored" data-anchor-id="dónde-estamos-ahora-1">¿Dónde estamos ahora?</h2>
<p><br>
- Realizamos la limpieza de la Etapa 1: limpiamos los nombres de las variables, eliminamos columnas/filas vacías, corregimos los tipos/clases de variables (caracteres a numéricos, recodificación de factores, Problemaas con fechas), abordamos los valores faltantes y las violaciones de los principios de datos ordenados (separación).</p>
<ul>
<li>Si bien la Etapa 1 es necesaria en casi todos los proyectos, a menudo es necesario realizar la limpieza de datos de la Etapa 2, pero no en todos los proyectos.</li>
</ul>
</section>
<section id="limpieza-de-datos-de-la-etapa-2" class="level2">
<h2 class="anchored" data-anchor-id="limpieza-de-datos-de-la-etapa-2">Limpieza de datos de la Etapa 2</h2>
<ul>
<li>Cubriremos los siguientes temas:
<ul>
<li>Reestructuración de datos en formato largo - ancho.</li>
<li>Ampliación o relleno de datos longitudinales.</li>
<li>Unión de múltiples conjuntos de datos.</li>
</ul></li>
</ul>
</section>
<section id="reestructuración-de-datos-en-formato-largo---ancho" class="level2">
<h2 class="anchored" data-anchor-id="reestructuración-de-datos-en-formato-largo---ancho">Reestructuración de datos en formato largo - ancho</h2>
<p>Formato Ancho</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...7`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `across(3:8, as.numeric)`.
Caused by warning:
! NAs introducidos por coerción</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  pat_id treatment start_mes end_mes start_bss end_bss start_emo end_emo
  &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 001    upa               3       0      75.9    9.85      79.3    39.8
2 002    uste              2       1      54.7   32.7       58.6    49.4
3 003    oza               1       1      28.5   28.5       32.2    35.9
4 004    upa               3       1      77.2   33.2       75.6    50.2
5 005    oza               3       2      78.8   56.8       74.3    65.0
6 006    uste              2       1      54.4   32.4       45.3    36.0</code></pre>
</div>
</div>
<p>Formato Largo</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  pat_id treatment measure   score
  &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
1 001    upa       start_mes  3   
2 001    upa       end_mes    0   
3 001    upa       start_bss 75.9 
4 001    upa       end_bss    9.85
5 001    upa       start_emo 79.3 
6 001    upa       end_emo   39.8 
7 002    uste      start_mes  2   
8 002    uste      end_mes    1   
9 002    uste      start_bss 54.7 </code></pre>
</div>
</div>
</section>
<section id="la-unidad-de-análisis---formato-ancho" class="level2">
<h2 class="anchored" data-anchor-id="la-unidad-de-análisis---formato-ancho">La Unidad de Análisis - Formato ancho</h2>
<ul>
<li>Es posible que deseemos realizar un análisis por paciente, ya que cada paciente puede (o no) tener el Resultadoado. Si tenemos múltiples observaciones o puntos de datos en cada paciente,esto se puede almacenar en formato ancho, con una fila por paciente.</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  pat_id treatment start_mes end_mes start_bss end_bss start_emo end_emo
  &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 001    upa               3       0      75.9    9.85      79.3    39.8
2 002    uste              2       1      54.7   32.7       58.6    49.4
3 003    oza               1       1      28.5   28.5       32.2    35.9
4 004    upa               3       1      77.2   33.2       75.6    50.2
5 005    oza               3       2      78.8   56.8       74.3    65.0
6 006    uste              2       1      54.4   32.4       45.3    36.0</code></pre>
</div>
</div>
</section>
<section id="la-unidad-de-análisis---formato-largo" class="level2">
<h2 class="anchored" data-anchor-id="la-unidad-de-análisis---formato-largo">La Unidad de Análisis - Formato largo</h2>
<ul>
<li>A menudo nos interesa el cambio en un Resultadoado a lo largo del tiempo.</li>
<li>Para que esto funcione, necesitamos una fila por cada medición del Resultadoado. Esto genera datos en formato largo, con múltiples visitas y mediciones para cada paciente.</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 4
   pat_id treatment measure   score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 001    upa       start_mes  3   
 2 001    upa       end_mes    0   
 3 001    upa       start_bss 75.9 
 4 001    upa       end_bss    9.85
 5 001    upa       start_emo 79.3 
 6 001    upa       end_emo   39.8 
 7 002    uste      start_mes  2   
 8 002    uste      end_mes    1   
 9 002    uste      start_bss 54.7 
10 002    uste      end_bss   32.7 
# ℹ 170 more rows</code></pre>
</div>
</div>
</section>
<section id="decisiónes-sobre-la-unidad-de-análisis" class="level2">
<h2 class="anchored" data-anchor-id="decisiónes-sobre-la-unidad-de-análisis">Decisiónes sobre la Unidad de Análisis</h2>
<ul>
<li>La unidad de análisis generalmente depende de la <code>Pregunta</code> que hacemos.</li>
</ul>
<p>¿Es el Paciente la Unidad de Análisis?</p>
<ul>
<li>¿El paciente falleció?</li>
<li>¿El paciente tuvo el Resultadoado de positivo/…?</li>
<li>¿El paciente alcanzó la remisión de la enfermedad?</li>
</ul>
<p>¿Es la consulta la unidad de análisis?</p>
<ul>
<li>¿Mejoró los valores de … de la Semana 0 a la Semana 8?</li>
<li>¿Disminuyeron las afecciones, conteos …. después del tratamiento?</li>
</ul>
</section>
<section id="decisiónes-sobre-la-unidad-de-análisis-1" class="level2">
<h2 class="anchored" data-anchor-id="decisiónes-sobre-la-unidad-de-análisis-1">Decisiónes sobre la Unidad de Análisis</h2>
<ul>
<li><p>La mayoría de las veces utilizarás datos en formato largo, y esta estructura de datos permite examinar múltiples predictores y Resultados.</p></li>
<li><p>Dependiendo de la pregunta de análisis, es posible que desees utilizar datos en formato ancho (generalmente con Resultados dicotómicos).</p></li>
</ul>
</section>
<section id="reorganización-de-los-datos-con-tidyr" class="level2">
<h2 class="anchored" data-anchor-id="reorganización-de-los-datos-con-tidyr">Reorganización de los datos con tidyr</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">El Problemaa</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Datos en formato ancho</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Datos en formato largo</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<ul>
<li><p>A menudo <em>ingresamos</em> los datos por para cada una de las muestras.</p></li>
<li><p>Terminamos con datos “en formato ancho” en lugar de datos “en formato largo”</p></li>
</ul>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  pat_id treatment start_mes end_mes start_bss end_bss start_emo end_emo
  &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 001    upa               3       0      75.9    9.85      79.3    39.8
2 002    uste              2       1      54.7   32.7       58.6    49.4
3 003    oza               1       1      28.5   28.5       32.2    35.9
4 004    upa               3       1      77.2   33.2       75.6    50.2
5 005    oza               3       2      78.8   56.8       74.3    65.0
6 006    uste              2       1      54.4   32.4       45.3    36.0</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 4
   pat_id treatment measure   score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 001    upa       start_mes  3   
 2 001    upa       end_mes    0   
 3 001    upa       start_bss 75.9 
 4 001    upa       end_bss    9.85
 5 001    upa       start_emo 79.3 
 6 001    upa       end_emo   39.8 
 7 002    uste      start_mes  2   
 8 002    uste      end_mes    1   
 9 002    uste      start_bss 54.7 
10 002    uste      end_bss   32.7 
# ℹ 170 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="reorganización-de-los-datos-con-tidyr-1" class="level2">
<h2 class="anchored" data-anchor-id="reorganización-de-los-datos-con-tidyr-1">Reorganización de los datos con tidyr</h2>
<ul>
<li>R (y la mayoría de las funciones de R) están vectorizados para manejar datos en formato largo.</li>
<li>Una pequeña observación por fila.</li>
<li>La mayoría de los análisis en R son más fáciles de ejecutar con datos en formato largo.</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 4
   pat_id treatment measure   score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 001    upa       start_mes  3   
 2 001    upa       end_mes    0   
 3 001    upa       start_bss 75.9 
 4 001    upa       end_bss    9.85
 5 001    upa       start_emo 79.3 
 6 001    upa       end_emo   39.8 
 7 002    uste      start_mes  2   
 8 002    uste      end_mes    1   
 9 002    uste      start_bss 54.7 
10 002    uste      end_bss   32.7 
# ℹ 170 more rows</code></pre>
</div>
</div>
</section>
<section id="pivoteando-a-un-formato-largo" class="level2">
<h2 class="anchored" data-anchor-id="pivoteando-a-un-formato-largo">Pivoteando a un formato largo</h2>
<ul>
<li>Necesitamos reorganizar los datos de formato ancho a formato largo de manera regular.</li>
<li>Esto “alarga” los datos, aumentando el número de filas y disminuyendo el número de columnas.</li>
</ul>
</section>
<section id="pivoteando-a-un-formato-largo-1" class="level2">
<h2 class="anchored" data-anchor-id="pivoteando-a-un-formato-largo-1">Pivoteando a un formato largo</h2>
<ul>
<li><p>Argumentos: <code>data</code>, <code>cols</code>, <code>names_to</code>, <code>values_to</code> y otros argumentos opcionales.</p></li>
<li><p>Detalles de la página de ayuda de tidyverse <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">aquí</a>.</p></li>
<li><p><code>data</code> = tu dataframe/tibble, puedes usar el operador pipe <code>|&gt; | %&gt;%</code>.</p></li>
<li><p><code>cols</code> = columnas a reorganizar, como un vector de nombres, por número o seleccionadas con las funciones de <a href="https://tidyselect.r-lib.org">tidyselect</a>.</p></li>
<li><p><code>names_to</code> = Nombre de la nueva columna o columnas a crear a partir de la información almacenada en los nombres de columna de los datos especificados por <code>cols</code>.</p></li>
<li><p><code>values_to</code> = nombre de la columna a crear a partir de los datos almacenados en los valores de las celdas.</p></li>
</ul>
</section>
<section id="pivoteando-a-un-formato-largo-2" class="level2">
<h2 class="anchored" data-anchor-id="pivoteando-a-un-formato-largo-2">Pivoteando a un formato largo</h2>
<p>Comencemos con la versión de en formato ancho(columnas seleccionadas de <code>messy_uc</code>)</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 8
   pat_id treatment start_mes end_mes start_bss end_bss start_emo end_emo
   &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 001    upa               3       0      75.9    9.85      79.3    39.8
 2 002    uste              2       1      54.7   32.7       58.6    49.4
 3 003    oza               1       1      28.5   28.5       32.2    35.9
 4 004    upa               3       1      77.2   33.2       75.6    50.2
 5 005    oza               3       2      78.8   56.8       74.3    65.0
 6 006    uste              2       1      54.4   32.4       45.3    36.0
 7 007    uste              3       2      79.7   57.7       66.6    57.8
 8 008    oza               3       2      75.0   53.0       74.5    62.0
 9 009    upa               2       0      53.1    9.06      50.0    27.8
10 010    oza               3       1      78.9   34.9       72.5    45.9
# ℹ 20 more rows</code></pre>
</div>
</div>
<ul>
<li>Ten en cuenta que hay 30 filas de observaciones, con 6 cantidades medidas para cada observación.</li>
</ul>
</section>
<section id="pivoteando-a-un-formato-largo-3" class="level2">
<h2 class="anchored" data-anchor-id="pivoteando-a-un-formato-largo-3">Pivoteando a un formato largo</h2>
<p>Esta es la versión larga con la que queremos terminar.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 4
   pat_id treatment measure   score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 001    upa       start_mes  3   
 2 001    upa       end_mes    0   
 3 001    upa       start_bss 75.9 
 4 001    upa       end_bss    9.85
 5 001    upa       start_emo 79.3 
 6 001    upa       end_emo   39.8 
 7 002    uste      start_mes  2   
 8 002    uste      end_mes    1   
 9 002    uste      start_bss 54.7 
10 002    uste      end_bss   32.7 
# ℹ 170 more rows</code></pre>
</div>
</div>
<ul>
<li>Ten en cuenta que ahora hay 180 filas (30*6), con una fila por cada medida y cada observación.</li>
</ul>
</section>
<section id="realizando-el-pivot_longer" class="level2">
<h2 class="anchored" data-anchor-id="realizando-el-pivot_longer">Realizando el pivot_longer()</h2>
<p>¿Qué valores queremos para estos argumentos clave para usar <code>tidyr::pivot_longer</code>?</p>
<ul>
<li><code>cols</code> (¿qué columnas queremos pivotear?)</li>
<li><code>names_to</code> (variable para almacenar los nombres de las columnas)</li>
<li><code>values_to</code> (variable para almacenar los valores de cada una de las mediciones)</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 8
   pat_id treatment start_mes end_mes start_bss end_bss start_emo end_emo
   &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 001    upa               3       0      75.9    9.85      79.3    39.8
 2 002    uste              2       1      54.7   32.7       58.6    49.4
 3 003    oza               1       1      28.5   28.5       32.2    35.9
 4 004    upa               3       1      77.2   33.2       75.6    50.2
 5 005    oza               3       2      78.8   56.8       74.3    65.0
 6 006    uste              2       1      54.4   32.4       45.3    36.0
 7 007    uste              3       2      79.7   57.7       66.6    57.8
 8 008    oza               3       2      75.0   53.0       74.5    62.0
 9 009    upa               2       0      53.1    9.06      50.0    27.8
10 010    oza               3       1      78.9   34.9       72.5    45.9
# ℹ 20 more rows</code></pre>
</div>
</div>
</section>
<section id="tidyrpivot_longer" class="level2">
<h2 class="anchored" data-anchor-id="tidyrpivot_longer"><code>tidyr::pivot_longer()</code></h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Problema: Datos con formato ancho</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Code: <code>tidyr::pivot_longer()</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Resultado: Datos en formato largo</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 8
   pat_id treatment start_mes end_mes start_bss end_bss start_emo end_emo
   &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 001    upa               3       0      75.9    9.85      79.3    39.8
 2 002    uste              2       1      54.7   32.7       58.6    49.4
 3 003    oza               1       1      28.5   28.5       32.2    35.9
 4 004    upa               3       1      77.2   33.2       75.6    50.2
 5 005    oza               3       2      78.8   56.8       74.3    65.0
 6 006    uste              2       1      54.4   32.4       45.3    36.0
 7 007    uste              3       2      79.7   57.7       66.6    57.8
 8 008    oza               3       2      75.0   53.0       74.5    62.0
 9 009    upa               2       0      53.1    9.06      50.0    27.8
10 010    oza               3       1      78.9   34.9       72.5    45.9
# ℹ 20 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-1"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="1" onclick="event.preventDefault();" href="">1</a><span id="annotated-cell-1-1" class="code-annotation-target"><a href="#annotated-cell-1-1" aria-hidden="true" tabindex="-1"></a>wide <span class="sc">|&gt;</span></span>
<span id="annotated-cell-1-2"><a href="#annotated-cell-1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="annotated-cell-1-3"><a href="#annotated-cell-1-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="st">"start_mes"</span><span class="sc">:</span><span class="st">"end_emo"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="2" onclick="event.preventDefault();" href="">2</a><span id="annotated-cell-1-4" class="code-annotation-target"><a href="#annotated-cell-1-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"measure"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="3" onclick="event.preventDefault();" href="">3</a><span id="annotated-cell-1-5" class="code-annotation-target"><a href="#annotated-cell-1-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"score"</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-1" data-target-annotation="4" onclick="event.preventDefault();" href="">4</a><span id="annotated-cell-1-6" class="code-annotation-target"><a href="#annotated-cell-1-6" aria-hidden="true" tabindex="-1"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-1" data-target-annotation="1">1</dt>
<dd>
<span data-code-lines="1" data-code-cell="annotated-cell-1" data-code-annotation="1">comienza con datos en formato ancho y utiliza <code>tidyr::pivot_longer()</code></span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="2">2</dt>
<dd>
<span data-code-lines="4" data-code-cell="annotated-cell-1" data-code-annotation="2">Indica qué columnas pivotar (selección por nombre, posición, coincidencia..),</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="3">3</dt>
<dd>
<span data-code-lines="5" data-code-cell="annotated-cell-1" data-code-annotation="3">Indica en qué columna (entre comillas) deben ir los nombres de las variables pivoteadas</span>
</dd>
<dt data-target-cell="annotated-cell-1" data-target-annotation="4">4</dt>
<dd>
<span data-code-lines="6" data-code-cell="annotated-cell-1" data-code-annotation="4">Indica en qué columna (entre comillas) deben ir los valores pivoteados</span>
</dd>
</dl>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 4
   pat_id treatment measure   score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 001    upa       start_mes  3   
 2 001    upa       end_mes    0   
 3 001    upa       start_bss 75.9 
 4 001    upa       end_bss    9.85
 5 001    upa       start_emo 79.3 
 6 001    upa       end_emo   39.8 
 7 002    uste      start_mes  2   
 8 002    uste      end_mes    1   
 9 002    uste      start_bss 54.7 
10 002    uste      end_bss   32.7 
# ℹ 170 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="un-problema-menor-separación-de-medidas" class="level2">
<h2 class="anchored" data-anchor-id="un-problema-menor-separación-de-medidas">Un problema menor: Separación de medidas</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Problema</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Código</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Resultado</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false" href="">Alternative within pivot_longer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false" href="">Alternativa dentro de pivot_longer</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<ul>
<li>La columna “measure” combina un punto en el tiempo y la medición.</li>
<li>Necesita ser separada.</li>
<li>Ya sabes cómo usar <em>separate()</em>
<ul>
<li>Argumentos</li>
</ul></li>
<li><code>col</code></li>
<li><code>sep</code></li>
<li><code>into</code></li>
</ul>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>tall <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> <span class="st">"measure"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">"_"</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"timept"</span>, <span class="st">"measure"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 5
   pat_id treatment timept measure score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;
 1 001    upa       start  mes      3   
 2 001    upa       end    mes      0   
 3 001    upa       start  bss     75.9 
 4 001    upa       end    bss      9.85
 5 001    upa       start  emo     79.3 
 6 001    upa       end    emo     39.8 
 7 002    uste      start  mes      2   
 8 002    uste      end    mes      1   
 9 002    uste      start  bss     54.7 
10 002    uste      end    bss     32.7 
# ℹ 170 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<ul>
<li>You can do this <em>within</em> pivot_longer with just one more argument <br>(if you <em>read all of the pivot_longer documentation</em>)</li>
</ul>
</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<ul>
<li>Puedes hacer esto <em>dentro de</em> pivot_longer con solo un argumento adicional <br>(si <em>lees toda la documentación de pivot_longer</em>)</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>wide <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"timept"</span>, <span class="st">"measure"</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 5
   pat_id treatment timept measure score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;
 1 001    upa       start  mes      3   
 2 001    upa       end    mes      0   
 3 001    upa       start  bss     75.9 
 4 001    upa       end    bss      9.85
 5 001    upa       start  emo     79.3 
 6 001    upa       end    emo     39.8 
 7 002    uste      start  mes      2   
 8 002    uste      end    mes      1   
 9 002    uste      start  bss     54.7 
10 002    uste      end    bss     32.7 
# ℹ 170 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="pivoteo-hacia-un-formato-ancho" class="level2">
<h2 class="anchored" data-anchor-id="pivoteo-hacia-un-formato-ancho">Pivoteo hacia un formato ancho</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Datos en formato largo</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>Los datos en formato largo son menos comunes, pero a veces son necesarios para el análisis por observación.</li>
<li>Aquí convertiremos la versión larga de nuestros datos seleccionados “messy_uc” nuevamente a una versión ancha.</li>
<li>Así es como se ven los datos en su forma larga.</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 4
   pat_id treatment measure   score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 001    upa       start_mes  3   
 2 001    upa       end_mes    0   
 3 001    upa       start_bss 75.9 
 4 001    upa       end_bss    9.85
 5 001    upa       start_emo 79.3 
 6 001    upa       end_emo   39.8 
 7 002    uste      start_mes  2   
 8 002    uste      end_mes    1   
 9 002    uste      start_bss 54.7 
10 002    uste      end_bss   32.7 
# ℹ 170 more rows</code></pre>
</div>
</div>
</div>
</div>
<section id="pivoteo-hacia-un-formato-ancho-1" class="level2">
<h2 class="anchored" data-anchor-id="pivoteo-hacia-un-formato-ancho-1">Pivoteo hacia un formato ancho</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tall <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(pat_id, treatment), <span class="co"># Variables no pivotadas</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> measure, <span class="co"># Variable que se convertirán en nombres de columnas</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> score <span class="co"># Variable que se convertirán en valores</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pivoteo-hacia-un-formato-ancho-2" class="level2">
<h2 class="anchored" data-anchor-id="pivoteo-hacia-un-formato-ancho-2">Pivoteo hacia un formato ancho</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 8
   pat_id treatment start_mes end_mes start_bss end_bss start_emo end_emo
   &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 001    upa               3       0      75.9    9.85      79.3    39.8
 2 002    uste              2       1      54.7   32.7       58.6    49.4
 3 003    oza               1       1      28.5   28.5       32.2    35.9
 4 004    upa               3       1      77.2   33.2       75.6    50.2
 5 005    oza               3       2      78.8   56.8       74.3    65.0
 6 006    uste              2       1      54.4   32.4       45.3    36.0
 7 007    uste              3       2      79.7   57.7       66.6    57.8
 8 008    oza               3       2      75.0   53.0       74.5    62.0
 9 009    upa               2       0      53.1    9.06      50.0    27.8
10 010    oza               3       1      78.9   34.9       72.5    45.9
# ℹ 20 more rows</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section>
<section id="datos-longitudinales" class="level2">
<h2 class="anchored" data-anchor-id="datos-longitudinales">Datos longitudinales</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li><p>Otro conjunto de problemas en la gestión de datos que puedes enfrentar son los datos recopilados a lo largo del tiempo, cuando ocurre una de estas dos cosas:</p>
<ul>
<li>Quieres analizar datos por día, mes o año, y los datos en están recopilados y registrados por <code>segundo</code>.</li>
<li>Te das cuenta de que faltan algunas observaciones y necesitas completar estas fechas como faltantes, pero realmente no quieres hacerlo manualmente.</li>
</ul></li>
<li><p>El paquete {padr} puede ayudar con estos problemas.</p></li>
</ul>
</div><p>::: {.column width=“40%”} <img src="images/long_data.png" class="img-fluid" alt="Datos longitudinales"></p>
</div>
<p>:::</p>
</section>
<section id="gestinando-las-fechas-y-horas-con-padr" class="level2">
<h2 class="anchored" data-anchor-id="gestinando-las-fechas-y-horas-con-padr">Gestinando las fechas y horas con padr</h2>
<div class="columns">
<div class="column" style="width:55%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  title                   time_stamp         
  &lt;chr&gt;                   &lt;dttm&gt;             
1 EMS: BACK PAINS/INJURY  2015-12-10 17:40:00
2 EMS: DIABETIC EMERGENCY 2015-12-10 17:40:00
3 Fire: GAS-ODOR/LEAK     2015-12-10 17:40:00
4 EMS: CARDIAC EMERGENCY  2015-12-10 17:40:01
5 EMS: DIZZINESS          2015-12-10 17:40:01
6 EMS: HEAD INJURY        2015-12-10 17:40:01</code></pre>
</div>
</div>
</div><div class="column" style="width:2%;">

</div><div class="column" style="width:43%;">
<ul>
<li>El conjunto de datos <strong>emergency</strong> en el paquete {padr} contiene &gt; 120K llamadas de emergencia del condado de Montgomery, PA durante un período de ~ 11 meses.</li>
<li>Cada llamada tiene un título y una marca de tiempo.</li>
</ul>
</div>
</div>
</section>
<section id="organizando-el-tiempo-a-un-nivel-utilizable" class="level2">
<h2 class="anchored" data-anchor-id="organizando-el-tiempo-a-un-nivel-utilizable">Organizando el tiempo a un nivel utilizable</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">Inicio</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">Data original</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false" href="">Organizando por mes</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false" href="">Organizando por semana</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<ul>
<li>La función <code>thicken</code> agrega una columna a un data.frame que tiene un intervalo más amplio que la variable original.</li>
<li>Los intervalos para {padr} son año, trimestre, mes, semana, día, hora, minuto y segundo.</li>
<li>La variable <code>time_stamp</code> tiene un intervalo de segundos.</li>
<li>Podemos aumentar el intervalo de los datos al intervalo de tiempo que necesitamos.</li>
<li>Luego podemos contar eventos por una unidad de tiempo utilizable.</li>
</ul>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>emergency <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
    lat   lng   zip title                   time_stamp          twp             
  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;                   &lt;dttm&gt;              &lt;chr&gt;           
1  40.3 -75.6 19525 EMS: BACK PAINS/INJURY  2015-12-10 17:40:00 NEW HANOVER     
2  40.3 -75.3 19446 EMS: DIABETIC EMERGENCY 2015-12-10 17:40:00 HATFIELD TOWNSH…
3  40.1 -75.4 19401 Fire: GAS-ODOR/LEAK     2015-12-10 17:40:00 NORRISTOWN      
4  40.1 -75.3 19401 EMS: CARDIAC EMERGENCY  2015-12-10 17:40:01 NORRISTOWN      
5  40.3 -75.6    NA EMS: DIZZINESS          2015-12-10 17:40:01 LOWER POTTSGROVE
6  40.3 -75.3 19446 EMS: HEAD INJURY        2015-12-10 17:40:01 LANSDALE        </code></pre>
</div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<ul>
<li>Vamos a agrupar por mes</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>emergency <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">thicken</span>(<span class="st">'month'</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lat, <span class="sc">-</span>lng, <span class="sc">-</span>zip)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  title                   time_stamp          twp               time_stamp_month
  &lt;chr&gt;                   &lt;dttm&gt;              &lt;chr&gt;             &lt;date&gt;          
1 EMS: BACK PAINS/INJURY  2015-12-10 17:40:00 NEW HANOVER       2015-12-01      
2 EMS: DIABETIC EMERGENCY 2015-12-10 17:40:00 HATFIELD TOWNSHIP 2015-12-01      
3 Fire: GAS-ODOR/LEAK     2015-12-10 17:40:00 NORRISTOWN        2015-12-01      
4 EMS: CARDIAC EMERGENCY  2015-12-10 17:40:01 NORRISTOWN        2015-12-01      
5 EMS: DIZZINESS          2015-12-10 17:40:01 LOWER POTTSGROVE  2015-12-01      
6 EMS: HEAD INJURY        2015-12-10 17:40:01 LANSDALE          2015-12-01      </code></pre>
</div>
</div>
</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<ul>
<li>Vamos a agrupar por semana</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>emergency <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">thicken</span>(<span class="st">'week'</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>lat, <span class="sc">-</span>lng, <span class="sc">-</span>zip)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  title                   time_stamp          twp               time_stamp_week
  &lt;chr&gt;                   &lt;dttm&gt;              &lt;chr&gt;             &lt;date&gt;         
1 EMS: BACK PAINS/INJURY  2015-12-10 17:40:00 NEW HANOVER       2015-12-06     
2 EMS: DIABETIC EMERGENCY 2015-12-10 17:40:00 HATFIELD TOWNSHIP 2015-12-06     
3 Fire: GAS-ODOR/LEAK     2015-12-10 17:40:00 NORRISTOWN        2015-12-06     
4 EMS: CARDIAC EMERGENCY  2015-12-10 17:40:01 NORRISTOWN        2015-12-06     
5 EMS: DIZZINESS          2015-12-10 17:40:01 LOWER POTTSGROVE  2015-12-06     
6 EMS: HEAD INJURY        2015-12-10 17:40:01 LANSDALE          2015-12-06     </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="agrupando-para-un-gráfico-mensual" class="level2">
<h2 class="anchored" data-anchor-id="agrupando-para-un-gráfico-mensual">Agrupando para un gráfico mensual</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true" href="">Objetivo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false" href="">Código</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false" href="">Resultado</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-4" role="tab" aria-controls="tabset-6-4" aria-selected="false" href="">Gráfico mensual</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<ul>
<li>La función <code>thicken</code> agrega una columna a un data.frame que tiene un intervalo mayor que la variable original.</li>
<li>La variable <code>time_stamp</code> tiene un intervalo de segundos.</li>
<li>Queremos agrupar estos datos (con marca de tiempo) a nivel mensual, luego seleccionar y contar las sobredosis (overdose).</li>
<li>Esto nos permitirá configurar el gráfico mensual de sobredosis que deseamos.</li>
</ul>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<ul>
<li>Agrupar a nivel mensual.</li>
<li>Luego contaremos las sobredosis por mes.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>emergency <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">thicken</span>(<span class="st">'month'</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(time_stamp_month) <span class="sc">|&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">overdoses =</span> <span class="fu">sum</span>(<span class="fu">str_detect</span>(title, <span class="st">"OVERDOSE"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(time_stamp_month, overdoses)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   time_stamp_month overdoses
   &lt;date&gt;               &lt;int&gt;
 1 2015-12-01              91
 2 2016-01-01             135
 3 2016-02-01             141
 4 2016-03-01             161
 5 2016-04-01             124
 6 2016-05-01             149
 7 2016-06-01             140
 8 2016-07-01             147
 9 2016-08-01             137
10 2016-09-01             171
11 2016-10-01              95</code></pre>
</div>
</div>
</div>
<div id="tabset-6-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-4-tab">
<div class="cell">
<div class="cell-output-display">
<p><img src="03-secion_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="rellenar-fechas-no-observadas-fines-de-semana-feriados" class="level2">
<h2 class="anchored" data-anchor-id="rellenar-fechas-no-observadas-fines-de-semana-feriados">Rellenar fechas no observadas (fines de semana, feriados …)</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>La función <code>pad()</code> te permite completar intervalos faltantes.</li>
<li>Permitiendo resolver discontinuidades extrañas en los datos.</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 3
   pat_id date         fcp
   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;
 1 001    2022-12-01  1574
 2 001    2022-12-02  1323
 3 001    2022-12-05   673
 4 001    2022-12-06   314
 5 001    2022-12-07   168
 6 002    2022-11-30  1393
 7 002    2022-12-01  1014
 8 002    2022-12-02   812
 9 002    2022-12-05   247
10 002    2022-12-06   118
11 003    2022-12-02   987
12 003    2022-12-05   438
13 003    2022-12-06   312
14 003    2022-12-05   194</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="completando-fechas-sin-observaciones" class="level2">
<h2 class="anchored" data-anchor-id="completando-fechas-sin-observaciones">Completando fechas sin observaciones</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true" href="">Problema</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false" href="">Codigo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false" href="">Resultado</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<ul>
<li>Podemos completar los días sin observaciones con la función <code>pad()</code>.</li>
</ul>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fcp <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pad</span>(<span class="at">group =</span> <span class="st">"pat_id"</span>) <span class="sc">|&gt;</span> <span class="co"># esto agrega líneas para cada día faltante en los datos</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>pad applied on the interval: day</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
   pat_id date         fcp
   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;
 1 001    2022-12-01  1574
 2 001    2022-12-02  1323
 3 001    2022-12-03    NA
 4 001    2022-12-04    NA
 5 001    2022-12-05   673
 6 001    2022-12-06   314
 7 001    2022-12-07   168
 8 002    2022-11-30  1393
 9 002    2022-12-01  1014
10 002    2022-12-02   812
11 002    2022-12-03    NA
12 002    2022-12-04    NA
# ℹ 9 more rows</code></pre>
</div>
</div>
</div><div class="column" style="width:60%;">
<ul>
<li>Se crean nuevas observaciones en las fechas faltantes</li>
<li>Se rellenan los valores NA para los FCPs faltantes, uno para cada día y grupo (pat_id)</li>
<li><code>pad()</code> completa los pat_ids faltantes</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="uniendo-datos" class="level2">
<h2 class="anchored" data-anchor-id="uniendo-datos">Uniendo datos</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>Otro problema en la gestión de datos que a menudo enfrentarás es que tienes dos conjuntos de datos interesantes y serían aún más interesantes si se pudieran vincular los datos de uno con los datos del otro.</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/choc_pb.jpeg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Better Together: <br>Chocolate and Peanut Butter <br> (Datasets)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="combinación-de-datos-de-diferentes-fuentes" class="level2">
<h2 class="anchored" data-anchor-id="combinación-de-datos-de-diferentes-fuentes">Combinación de datos de diferentes fuentes</h2>
<div class="columns">
<div class="column" style="width:70%;">
<ul>
<li>A menudo recopilamos datos de diferentes fuentes que luego queremos combinar para su análisis.</li>
<li>Datos de tu Registro Médico Electrónico local.</li>
<li>Datos del CDC (Centros para el Control y la Prevención de Enfermedades).</li>
<li>Datos del censos poblacionales.</li>
<li>Los datos externos pueden ampliar la comprensión de nuestros datos.</li>
</ul>
</div><div class="column" style="width:30%;">
<p><img src="images/LuxoJr_Lamp.webp" class="img-fluid"></p>
</div>
</div>
</section>
<section id="combinación-de-datos-de-diferentes-fuentes-1" class="level2">
<h2 class="anchored" data-anchor-id="combinación-de-datos-de-diferentes-fuentes-1">Combinación de datos de diferentes fuentes</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true" href="">Problema</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false" href="">Datos</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false" href="">Codigo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-4" role="tab" aria-controls="tabset-8-4" aria-selected="false" href="">ResultadO</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<ul>
<li>Tenemos 2 conjuntos de datos, uno de Demografía y Distrito Censal local, y otro del CDC que tiene valores del Índice de Vulnerabilidad Social (SVI) por Distrito Censal.</li>
<li>Queremos saber si el SVI del vecindario de cada paciente influye en los resultados de salud.</li>
<li>Necesitamos hacer una unión (<code>left_join</code>) de estos conjuntos de datos mediante la coincidencia en el Distrito Censal.</li>
</ul>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<ul>
<li>Cual es la variable en común - variable de unión - variable de conexión.</li>
</ul>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  pat_id name                 htn census_tract
  &lt;chr&gt;  &lt;chr&gt;              &lt;dbl&gt;        &lt;dbl&gt;
1 001    Arthur Blankenship     0  26161404400
2 002    Britney Jonas          0  26161405100
3 003    Sally Davis            1  26161402100
4 004    Al Jones               0  26161403200
5 005    Gary Hamill            1  26161405200
6 006    Ken Bartoletti         0  26161404500
7 007    Ike Gerhold            0  26161405600
8 008    Tatiana Grant          0  26161404300
9 009    Antione Delacroix      1  26161405500</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<ul>
<li><code>cdc</code></li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  census_tract   svi
         &lt;dbl&gt; &lt;dbl&gt;
1  26161404400  0.12
2  26161405100  0.67
3  26161402100  0.43
4  26161403200  0.07
5  26161405200  0.71
6  26161404500  0.23
7  26161405600  0.27
8  26161404300  0.21
9  26161405500  0.62</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<ul>
<li>Reemplaza los argumentos genéricos de la función <code>left_join()</code> para unir los datos demográficos (<em>demo</em>) en el lado izquierdo y agregar el índice de Vulnerabilidad Social (SVI) del conjunto de datos <em>cdc</em> en el lado derecho.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(demo, cdc, <span class="at">by =</span> <span class="st">"census_tract"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-8-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-4-tab">
<ul>
<li>Ahora que se ha completado la unión, puedes hacer tu pregunta:
<ul>
<li>¿Existe una asociación entre la vulnerabilidad social y la hipertensión?</li>
</ul></li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 5
  pat_id name                 htn census_tract   svi
  &lt;chr&gt;  &lt;chr&gt;              &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt;
1 001    Arthur Blankenship     0  26161404400  0.12
2 002    Britney Jonas          0  26161405100  0.67
3 003    Sally Davis            1  26161402100  0.43
4 004    Al Jones               0  26161403200  0.07
5 005    Gary Hamill            1  26161405200  0.71
6 006    Ken Bartoletti         0  26161404500  0.23
7 007    Ike Gerhold            0  26161405600  0.27
8 008    Tatiana Grant          0  26161404300  0.21
9 009    Antione Delacroix      1  26161405500  0.62</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="uniones-avanzadas" class="level2">
<h2 class="anchored" data-anchor-id="uniones-avanzadas">Uniones avanzadas</h2>
<ul>
<li>Hay varios tipos de uniones avanzadas (<em>semi_join, anti_join, inner_join, full_join, union, intersect, setdiff</em>) que resultan útiles de vez en cuando.</li>
<li>Los diferentes tipos de uniones están bien explicados <a href="http://statseducation.com/Introduction-to-R/modules/tidy%20data/joins/#:~:text=semi_join(x%2C%20y)%3A%20Return,This%20is%20a%20filtering%20join.">aquí</a></li>
</ul>
<div class="columns">
<div class="column" style="width:45%;">
<ul>
<li>Filtra tus datos (x), manteniendo solo aquellos (y = hospitalizados) que fueron hospitalizados.</li>
</ul>
<div class="animations">
<img alt="gif here" width="100%" height="100%" src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/main/images/semi-join.gif">
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<ul>
<li>Filtra tus datos (x), manteniendo solo aquellos (y = muertos) que NO están muertos.</li>
</ul>
<div class="animations">
<img alt="gif here" width="100%" height="100%" src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/main/images/anti-join.gif">
</div>
</div>
</div>
</section>
<section id="opciones-avanzadas" class="level2">
<h2 class="anchored" data-anchor-id="opciones-avanzadas">Opciones avanzadas</h2>
<ul>
<li>Puedes usar <code>join_by</code> para más opciones de unión, incluyendo
<ul>
<li>desigualdad: solo hacer coincidencia si es mayor que un valor</li>
<li>fecha más cercana</li>
<li><code>fecha más cercana</code> siempre y cuando sea <em>después</em> de la fecha de comparación, pero dentro de los 30 días</li>
<li>solo hacer coincidencia si el intervalo/fecha <code>se superpone</code></li>
<li>hacer coincidencia si el valor está <code>dentro</code> de un rango</li>
</ul></li>
<li>Obtén más información en <a href="https://dplyr.tidyverse.org/reference/join_by.html">Join Specifications</a></li>
</ul>
</section>
<section id="data-horror" class="level2">
<h2 class="anchored" data-anchor-id="data-horror">Data Horror</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Data So Messy, it Constitutes a Data Crime</p>
<p><br> <img src="images/messy.png" class="img-fluid" alt="Messy"></p>
<p><br> What Should You Do?</p>
</div><div class="column" style="width:50%;">
<iframe src="https://giphy.com/embed/jquDWJfPUMCiI" width="480" height="428" frameborder="0" class="giphy-embed" allowfullscreen="">
</iframe>
<p>
<a href="https://giphy.com/gifs/scared-shocked-jquDWJfPUMCiI"> The Horror! The Horror!</a>
</p>
</div>
</div>
</section>
<section id="two-options" class="level2">
<h2 class="anchored" data-anchor-id="two-options">Two Options</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ol type="1">
<li>You can find the person who collected/entered the data</li>
</ol>
<ul>
<li>If you don’t correct this behavior now, this will torture <em><strong>many</strong></em> future data analysts</li>
<li>Educate in this <em>teachable moment</em> about tidy data</li>
<li>Send them to watch Tidy Spreadsheets on YouTube <a href="https://www.youtube.com/watch?v=9f-hpJbjKZo">here</a> to prevent this kind of Data Crime in the future.</li>
<li><strong>Improve</strong> the world, one (now tidy) data collector at a time.</li>
</ul>
</div><p>::: {.column width=“50%” .fragment} 2. There is no way to find the person who collected/entered the data</p><ul>
<li>Pull out some advanced data cleaning packages made for this particular kind of mess</li>
<li>{unpivotr}</li>
<li>{tidyxl}</li>
<li>{unheadr}</li>
<li>Watch the unpivotr/tidyxl 14 min video <a href="https://www.youtube.com/watch?v=ShWxAqnY2YE">here</a></li>
<li>Learn from a free e-book, <a href="https://nacnudus.github.io/spreadsheet-munging-strategies/">Spreadsheet Munging Strategies</a></li>
</ul>
</div>
<p>:::</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>