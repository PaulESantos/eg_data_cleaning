<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.333">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>peter</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="03-peter_files/libs/clipboard/clipboard.min.js"></script>
<script src="03-peter_files/libs/quarto-html/quarto.js"></script>
<script src="03-peter_files/libs/quarto-html/popper.min.js"></script>
<script src="03-peter_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="03-peter_files/libs/quarto-html/anchor.min.js"></script>
<link href="03-peter_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="03-peter_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="03-peter_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="03-peter_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="03-peter_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="03-peter_files/libs/countdown-0.4.0/countdown.css" rel="stylesheet">
<script src="03-peter_files/libs/countdown-0.4.0/countdown.js"></script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="wrangling-your-data" class="level1">
<h1>Wrangling your Data</h1>
<section id="where-are-we-now" class="level2">
<h2 class="anchored" data-anchor-id="where-are-we-now">Where are We Now?</h2>
<ul>
<li>We have done DEV (Data Evaluation and Validation) - more validation to be done</li>
<li>Discussed the importance of preventing data errors at the source - data collection and entry</li>
<li>Did Stage 1 cleaning - variable names, remove empty columns/rows, variable types/classes (characters in numeric, recoding factors, date madness), missingness, violations of tidy data principles (separate), added meaningful variable labels.</li>
</ul>
</section>
<section id="deciding-on-the-unit-of-observation" class="level2">
<h2 class="anchored" data-anchor-id="deciding-on-the-unit-of-observation">Deciding on the Unit of Observation</h2>
<ul>
<li>In Prospective Data Collection, a patient arrives for a visit. All data collected are part of the same observation/visit.
<ul>
<li>Alternatively, we can divide a visit into distinct observations, like blood pressure, a PHQ-9 depression questionnaire, and a hemoglobin measurement (all on the same date)</li>
</ul></li>
<li>In retrospective data review, we can divide the observations up as we choose. For inpatient stays, we need to decide <em>a priori</em> on how to handle multiple observations of the same type (e.g., vitals q6h) in the same day.
<ul>
<li>use the 0800 observation each day?</li>
<li>use the daily average for SBP and DBP?</li>
<li>use the max values each day?</li>
</ul></li>
</ul>
</section>
<section id="what-is-the-unit-of-analysis" class="level2">
<h2 class="anchored" data-anchor-id="what-is-the-unit-of-analysis">What is the Unit of Analysis?</h2>
<ul>
<li>While the unit of observation may be straightforward for outpatient visits, and complicated for inpatient stays, in the end we need to select a Unit of Analysis</li>
<li>This Unit of Analysis usually depends on the <strong>Question</strong> we want to ask</li>
</ul>
</section>
<section id="is-the-unit-of-analysis-the-patient" class="level2">
<h2 class="anchored" data-anchor-id="is-the-unit-of-analysis-the-patient">Is the Unit of Analysis the Patient?</h2>
<ul>
<li>Did the patient die?</li>
<li>Did the patient have the outcome of colectomy?</li>
<li>Did the patient reach disease remission?</li>
</ul>
</section>
<section id="is-the-unit-of-analysis-the-visitencounter" class="level2">
<h2 class="anchored" data-anchor-id="is-the-unit-of-analysis-the-visitencounter">Is the Unit of Analysis the Visit/Encounter?</h2>
<ul>
<li>Often these are within-patient outcomes
<ul>
<li>Did the C-reactive protein improve from Week 0 to Week 8?</li>
<li>Did the number of sickle cell crises/year decrease after CRISPR gene therapy?</li>
<li>Did the endoscopic ulcer score decrease on the experimental therapy vs placebo?</li>
</ul></li>
</ul>
</section>
<section id="reshaping-your-data-with-tidyr" class="level2">
<h2 class="anchored" data-anchor-id="reshaping-your-data-with-tidyr">Reshaping your data with tidyr</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">The Problem</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">Wide Version of Data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Tall Version of Data</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<ul>
<li>We often <em>enter</em> data by patient</li>
<li>Spreadsheets encourage us to enter longitudinal data as long rows (per patient)</li>
<li>We end up with <strong>wide</strong>, rather than <strong>tall</strong> data</li>
</ul>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 8
  pat_id treatment start_mes end_mes start_bss end_bss
  &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 001    upa               3       0      75.5    9.46
2 002    uste              2       1      53.6   31.6 
3 003    oza               1       1      25.5   25.5 
4 004    upa               3       1      79.4   35.4 
5 005    oza               3       2      79.5   57.5 
6 006    uste              2       1      54.5   32.5 
# ℹ 2 more variables: start_emo &lt;dbl&gt;, end_emo &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 4
   pat_id treatment measure   score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 001    upa       start_mes  3   
 2 001    upa       end_mes    0   
 3 001    upa       start_bss 75.5 
 4 001    upa       end_bss    9.46
 5 001    upa       start_emo 73.3 
 6 001    upa       end_emo   32.0 
 7 002    uste      start_mes  2   
 8 002    uste      end_mes    1   
 9 002    uste      start_bss 53.6 
10 002    uste      end_bss   31.6 
# ℹ 170 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="reshaping-your-data-with-tidyr-1" class="level2">
<h2 class="anchored" data-anchor-id="reshaping-your-data-with-tidyr-1">Reshaping your data with tidyr</h2>
<ul>
<li>R (and most R functions) are vectorized to handle tall data</li>
<li>One small observation per row</li>
<li>Most analyses in R are easier with tall data</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 4
   pat_id treatment measure   score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 001    upa       start_mes  3   
 2 001    upa       end_mes    0   
 3 001    upa       start_bss 75.5 
 4 001    upa       end_bss    9.46
 5 001    upa       start_emo 73.3 
 6 001    upa       end_emo   32.0 
 7 002    uste      start_mes  2   
 8 002    uste      end_mes    1   
 9 002    uste      start_bss 53.6 
10 002    uste      end_bss   31.6 
# ℹ 170 more rows</code></pre>
</div>
</div>
</section>
<section id="pivoting-longer-common" class="level2">
<h2 class="anchored" data-anchor-id="pivoting-longer-common">Pivoting Longer (common)</h2>
<ul>
<li>We need to ‘pivot’ data from wide to tall on the regular</li>
<li>This “lengthens” data, increasing the number of rows, and decreasing the number of columns</li>
<li>We will be looking at Visit Dates (Start vs End) and Measures</li>
</ul>
</section>
<section id="pivoting-longer" class="level2">
<h2 class="anchored" data-anchor-id="pivoting-longer">Pivoting Longer</h2>
<ul>
<li>Arguments: data, cols, names_to, values_to, and many optional arguments</li>
<li>Details from the tidyverse help page are <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">here</a></li>
<li><strong>data</strong> is your dataframe/tibble - you can pipe this in</li>
<li><strong>cols</strong> = columns to pivot, as a vector of names, or by number, or selected with <a href="https://tidyselect.r-lib.org">tidyselect</a> functions</li>
<li><strong>names_to</strong> = A character vector specifying the new column or columns to create from the information stored in the column names of data specified by cols.</li>
<li><strong>values_to</strong> = A string specifying the name of the column to create from the data stored in cell values.</li>
</ul>
</section>
<section id="pivoting-longer-example" class="level2">
<h2 class="anchored" data-anchor-id="pivoting-longer-example">Pivoting Longer (Example)</h2>
<p>Let’s start with the wide version (selected columns from messy_uc)</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 8
   pat_id treatment start_mes end_mes start_bss end_bss
   &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 001    upa               3       0      75.5    9.46
 2 002    uste              2       1      53.6   31.6 
 3 003    oza               1       1      25.5   25.5 
 4 004    upa               3       1      79.4   35.4 
 5 005    oza               3       2      79.5   57.5 
 6 006    uste              2       1      54.5   32.5 
 7 007    uste              3       2      79.0   57.0 
 8 008    oza               3       2      79.0   57.0 
 9 009    upa               2       0      53.1    9.06
10 010    oza               3       1      77.4   33.4 
# ℹ 20 more rows
# ℹ 2 more variables: start_emo &lt;dbl&gt;, end_emo &lt;dbl&gt;</code></pre>
</div>
</div>
<ul>
<li>Note that there are 30 rows, one per patient, with 6 measured quantities for each patient.</li>
</ul>
</section>
<section id="pivoting-longer-example-1" class="level2">
<h2 class="anchored" data-anchor-id="pivoting-longer-example-1">Pivoting Longer (Example)</h2>
<p>This is the tall version we want to end up with.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 4
   pat_id treatment measure   score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 001    upa       start_mes  3   
 2 001    upa       end_mes    0   
 3 001    upa       start_bss 75.5 
 4 001    upa       end_bss    9.46
 5 001    upa       start_emo 73.3 
 6 001    upa       end_emo   32.0 
 7 002    uste      start_mes  2   
 8 002    uste      end_mes    1   
 9 002    uste      start_bss 53.6 
10 002    uste      end_bss   31.6 
# ℹ 170 more rows</code></pre>
</div>
</div>
<ul>
<li>Note that there now 180 rows (30*6), with one row per observation measure.</li>
</ul>
</section>
<section id="doing-the-pivot_longer" class="level2">
<h2 class="anchored" data-anchor-id="doing-the-pivot_longer">Doing the pivot_longer()</h2>
<p>What values do we want for these key arguments in order to pivot_longer?</p>
<ul>
<li>cols (which columns to pivot)</li>
<li>names_to (variable to store the names)</li>
<li>values_to (variable to store the values)</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 8
   pat_id treatment start_mes end_mes start_bss end_bss
   &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 001    upa               3       0      75.5    9.46
 2 002    uste              2       1      53.6   31.6 
 3 003    oza               1       1      25.5   25.5 
 4 004    upa               3       1      79.4   35.4 
 5 005    oza               3       2      79.5   57.5 
 6 006    uste              2       1      54.5   32.5 
 7 007    uste              3       2      79.0   57.0 
 8 008    oza               3       2      79.0   57.0 
 9 009    upa               2       0      53.1    9.06
10 010    oza               3       1      77.4   33.4 
# ℹ 20 more rows
# ℹ 2 more variables: start_emo &lt;dbl&gt;, end_emo &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="pivoting-longer-in-action" class="level2">
<h2 class="anchored" data-anchor-id="pivoting-longer-in-action">Pivoting Longer In Action</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true" href="">Problem: Wide</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false" href="">Code: pivot_longer</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false" href="">Result: Tall</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 8
   pat_id treatment start_mes end_mes start_bss end_bss
   &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 001    upa               3       0      75.5    9.46
 2 002    uste              2       1      53.6   31.6 
 3 003    oza               1       1      25.5   25.5 
 4 004    upa               3       1      79.4   35.4 
 5 005    oza               3       2      79.5   57.5 
 6 006    uste              2       1      54.5   32.5 
 7 007    uste              3       2      79.0   57.0 
 8 008    oza               3       2      79.0   57.0 
 9 009    upa               2       0      53.1    9.06
10 010    oza               3       1      77.4   33.4 
# ℹ 20 more rows
# ℹ 2 more variables: start_emo &lt;dbl&gt;, end_emo &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>wide <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="st">"start_mes"</span><span class="sc">:</span><span class="st">"end_emo"</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># could also use 3:8</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"measure"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 4
   pat_id treatment measure   score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
 1 001    upa       start_mes  3   
 2 001    upa       end_mes    0   
 3 001    upa       start_bss 75.5 
 4 001    upa       end_bss    9.46
 5 001    upa       start_emo 73.3 
 6 001    upa       end_emo   32.0 
 7 002    uste      start_mes  2   
 8 002    uste      end_mes    1   
 9 002    uste      start_bss 53.6 
10 002    uste      end_bss   31.6 
# ℹ 170 more rows</code></pre>
</div>
</div>
<ul>
<li>Does this make sense so far?</li>
<li>Zoom reaction: “thumbs up” emoji 👍 if yes
<ul>
<li>“raised hand” emoji ✋ if puzzled/questions</li>
</ul></li>
</ul>
</div>
</div>
</div>
</section>
<section id="one-minor-issue---separation-of-measure" class="level2">
<h2 class="anchored" data-anchor-id="one-minor-issue---separation-of-measure">One Minor Issue - Separation of measure</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true" href="">Problem</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false" href="">Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false" href="">Result</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false" href="">Alternative within pivot_longer</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<ul>
<li>the “measure” column combines a timepoint and the measure</li>
<li>Needs to be separated.</li>
<li>You already know how to use <em>separate()</em></li>
<li>Arguments
<ul>
<li>col</li>
<li>sep</li>
<li>into</li>
</ul></li>
</ul>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>tall <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> <span class="st">"measure"</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">"_"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"timept"</span>, <span class="st">"measure"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 5
   pat_id treatment timept measure score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;
 1 001    upa       start  mes      3   
 2 001    upa       end    mes      0   
 3 001    upa       start  bss     75.5 
 4 001    upa       end    bss      9.46
 5 001    upa       start  emo     73.3 
 6 001    upa       end    emo     32.0 
 7 002    uste      start  mes      2   
 8 002    uste      end    mes      1   
 9 002    uste      start  bss     53.6 
10 002    uste      end    bss     31.6 
# ℹ 170 more rows</code></pre>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<ul>
<li>You can do this <em>within</em> pivot_longer with one more argument (if you are <em>fancy</em>)</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>wide <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"timept"</span>, <span class="st">"measure"</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 180 × 5
   pat_id treatment timept measure score
   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;
 1 001    upa       start  mes      3   
 2 001    upa       end    mes      0   
 3 001    upa       start  bss     75.5 
 4 001    upa       end    bss      9.46
 5 001    upa       start  emo     73.3 
 6 001    upa       end    emo     32.0 
 7 002    uste      start  mes      2   
 8 002    uste      end    mes      1   
 9 002    uste      start  bss     53.6 
10 002    uste      end    bss     31.6 
# ℹ 170 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="pivoting-longer-1" class="level2">
<h2 class="anchored" data-anchor-id="pivoting-longer-1">Pivoting Longer</h2>
<ul>
<li>Your Turn (Exercise) with endo_data</li>
<li>Measurements of Trans-Epithelial Electrical Resistance (TEER, the inverse of leakiness) in biopsies of 3 segments of intestine.</li>
<li>This could be affected by portal hypertension in pts with liver cirrhosis</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   pat_id portal_htn duod_teer ileal_teer colon_teer
    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1      1          1      4.33       14.6       16.2
 2      2          0     11.7        16.0       19.0
 3      3          1      4.12       13.8       15.2
 4      4          1      4.62       16.4       18.1
 5      5          0     12.4        15.8       19.0
 6      6          0     13.0        16.2       18.8
 7      7          0     11.9        15.7       18.3
 8      8          1      4.87       16.6       18.8
 9      9          1      4.23       15.0       16.9
10     10          0     12.8        16.7       19.1</code></pre>
</div>
</div>
</section>
<section id="pivoting-longer-with-endo_data" class="level2">
<h2 class="anchored" data-anchor-id="pivoting-longer-with-endo_data">Pivoting Longer with endo_data</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true" href="">Dataset</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false" href="">Arguments</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false" href="">Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-4" role="tab" aria-controls="tabset-4-4" aria-selected="false" href="">Solution</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-5" role="tab" aria-controls="tabset-4-5" aria-selected="false" href="">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   pat_id portal_htn duod_teer ileal_teer colon_teer
    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1      1          1      4.33       14.6       16.2
 2      2          0     11.7        16.0       19.0
 3      3          1      4.12       13.8       15.2
 4      4          1      4.62       16.4       18.1
 5      5          0     12.4        15.8       19.0
 6      6          0     13.0        16.2       18.8
 7      7          0     11.9        15.7       18.3
 8      8          1      4.87       16.6       18.8
 9      9          1      4.23       15.0       16.9
10     10          0     12.8        16.7       19.1</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<ul>
<li>What values do you want to use for:
<ul>
<li>cols</li>
<li>names_pattern = “(.+)_teer”</li>
<li>names_to</li>
<li>values_to</li>
</ul></li>
<li>Note that we are giving you the value for names_pattern, which means that we want to keep the characters of the name (of whatever length) before “_teer”</li>
</ul>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<ul>
<li>Fill in the blanks to pivot this dataset to tall format, with columns for the intestinal location and the teer value.</li>
<li>Note that we are giving you names_pattern</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>endo_data <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span>  ,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(.+)_teer"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span>   ,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-4-tab">
<ul>
<li>Fill in the blanks to pivot this dataset to tall format, with columns for the intestinal location and the teer value.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>endo_data <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="st">"duod_teer"</span><span class="sc">:</span><span class="st">"colon_teer"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(.+)_teer"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"location"</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"teer"</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Run the code, and look at the resulting table.</li>
</ul>
</div>
<div id="tabset-4-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-5-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 4
   pat_id portal_htn location  teer
    &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;
 1      1          1 duod      4.33
 2      1          1 ileal    14.6 
 3      1          1 colon    16.2 
 4      2          0 duod     11.7 
 5      2          0 ileal    16.0 
 6      2          0 colon    19.0 
 7      3          1 duod      4.12
 8      3          1 ileal    13.8 
 9      3          1 colon    15.2 
10      4          1 duod      4.62
# ℹ 20 more rows</code></pre>
</div>
</div>
<ul>
<li>Do you think that portal hypertension has an effect on TEER and (its inverse) epithelial leakiness?</li>
</ul>
</div>
</div>
</div>
</section>
<section id="exercise-ph1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-ph1">Exercise PH1</h2>
<p><br></p>
<p>Complete Data Cleaning Fundamentals Exercise PH1.</p>
<ul>
<li><p>If you have the exercise done correctly, click on the Reactions tab in Zoom, and click to put the “thumbs up” emoji 👍 on your screen.</p></li>
<li><p>If you are having trouble, click on the Reactions tab in Zoom, and click to put the “raised hand” emoji ✋ on your screen.</p></li>
</ul>
<p><a href="https://shannonpileggi.github.io/rmedicine-data-cleaning-2023/exercises.html" target="_blank">–&gt; Take me to the exercises &lt;–</a></p>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_69cac560" data-update-every="1" tabindex="0" style="right:0;bottom:0;font-size:4em;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
<section id="pivoting-wider" class="level2">
<h2 class="anchored" data-anchor-id="pivoting-wider">Pivoting Wider</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true" href="">Code to Pivot</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false" href="">Wider Result</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>tall <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(pat_id, treatment), <span class="co"># Variables not pivoted</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> measure, <span class="co"># will become column names</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> score <span class="co"># will become values</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 8
   pat_id treatment start_mes end_mes start_bss end_bss
   &lt;chr&gt;  &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
 1 001    upa               3       0      75.5    9.46
 2 002    uste              2       1      53.6   31.6 
 3 003    oza               1       1      25.5   25.5 
 4 004    upa               3       1      79.4   35.4 
 5 005    oza               3       2      79.5   57.5 
 6 006    uste              2       1      54.5   32.5 
 7 007    uste              3       2      79.0   57.0 
 8 008    oza               3       2      79.0   57.0 
 9 009    upa               2       0      53.1    9.06
10 010    oza               3       1      77.4   33.4 
# ℹ 20 more rows
# ℹ 2 more variables: start_emo &lt;dbl&gt;, end_emo &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="fill-in-unobserved-date-times-with-padr" class="level2">
<h2 class="anchored" data-anchor-id="fill-in-unobserved-date-times-with-padr">Fill in Unobserved Date-Times with padr</h2>
<div class="columns">
<div class="column" style="width:55%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  title                   time_stamp         
  &lt;chr&gt;                   &lt;dttm&gt;             
1 EMS: BACK PAINS/INJURY  2015-12-10 17:40:00
2 EMS: DIABETIC EMERGENCY 2015-12-10 17:40:00
3 Fire: GAS-ODOR/LEAK     2015-12-10 17:40:00
4 EMS: CARDIAC EMERGENCY  2015-12-10 17:40:01
5 EMS: DIZZINESS          2015-12-10 17:40:01
6 EMS: HEAD INJURY        2015-12-10 17:40:01</code></pre>
</div>
</div>
</div><div class="column" style="width:45%;">
<ul>
<li>The <strong>emergency</strong> data set in the {padr} package contains &gt; 120K emergency calls from Montgomery County, PA over a period of ~ 11 months.</li>
<li>Each call has a title and a timestamp</li>
</ul>
</div>
</div>
</section>
<section id="thickening-time-to-a-usable-level" class="level2">
<h2 class="anchored" data-anchor-id="thickening-time-to-a-usable-level">Thickening Time to a Usable Level</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true" href="">Goal</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false" href="">Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false" href="">Result</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<ul>
<li>The thicken function adds a column to a data frame that is of a higher interval than the original variable.</li>
<li>The variable <strong>time_stamp</strong> has the interval of seconds</li>
<li>We can thicken the data to day, or to week, or to month.</li>
<li>Then we can count events by a usable unit of time</li>
</ul>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<ul>
<li>We will thicken to month</li>
<li>Then count overdoses by month</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>emergency <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">thicken</span>(<span class="st">'month'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(title, <span class="st">"OVERDOSE"</span>)) <span class="sc">|&gt;</span>   <span class="fu">group_by</span>(time_stamp_month) <span class="sc">|&gt;</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ods =</span> <span class="fu">sum</span>(<span class="fu">str_detect</span>(title, <span class="st">"OVERDOSE"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(time_stamp_month, ods) <span class="sc">|&gt;</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<ul>
<li>This lets us count events like overdoses by month with time_stamp_month.</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
# Groups:   time_stamp_month [11]
   time_stamp_month   ods
   &lt;date&gt;           &lt;int&gt;
 1 2015-12-01          91
 2 2016-01-01         135
 3 2016-02-01         141
 4 2016-03-01         161
 5 2016-04-01         124
 6 2016-05-01         149
 7 2016-06-01         140
 8 2016-07-01         147
 9 2016-08-01         137
10 2016-09-01         171
11 2016-10-01          95</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="padding-unobserved-dates-weekends" class="level2">
<h2 class="anchored" data-anchor-id="padding-unobserved-dates-weekends">Padding unobserved dates (weekends?)</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>The pad function allows you to fill in missing intervals.</li>
<li>As an example, my hospital only runs fecal calprotectin tests on weekdays.</li>
<li>This can lead to weird discontinuities in data over a weekend (Dec 3-4).</li>
<li>No observations on weekend days.</li>
</ul>
</div><div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 3
   pat_id date         fcp
   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;
 1 001    2022-12-01  1574
 2 001    2022-12-02  1323
 3 001    2022-12-05   673
 4 001    2022-12-06   314
 5 001    2022-12-07   168
 6 002    2022-11-30  1393
 7 002    2022-12-01  1014
 8 002    2022-12-02   812
 9 002    2022-12-05   247
10 002    2022-12-06   118
11 003    2022-12-02   987
12 003    2022-12-05   438
13 003    2022-12-06   312
14 003    2022-12-05   194
15 003    2022-12-06   101</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="padding-unobserved-times" class="level2">
<h2 class="anchored" data-anchor-id="padding-unobserved-times">Padding Unobserved Times</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true" href="">The Problem</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false" href="">The Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-3" role="tab" aria-controls="tabset-7-3" aria-selected="false" href="">The Result</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<ul>
<li>We can fill in (pad) the unobserved weekend days with the <strong>pad()</strong> function.</li>
</ul>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fcp <span class="sc">|&gt;</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pad</span>(<span class="at">group =</span> <span class="st">"pat_id"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">fill</span>(pat_id) <span class="sc">|&gt;</span> <span class="co"># fill in the missing pat_ids</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-3-tab">
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>pad applied on the interval: day</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
   pat_id date         fcp
   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt;
 1 001    2022-12-01  1574
 2 001    2022-12-02  1323
 3 001    2022-12-03    NA
 4 001    2022-12-04    NA
 5 001    2022-12-05   673
 6 001    2022-12-06   314
 7 001    2022-12-07   168
 8 002    2022-11-30  1393
 9 002    2022-12-01  1014
10 002    2022-12-02   812
11 002    2022-12-03    NA
12 002    2022-12-04    NA
13 002    2022-12-05   247
14 002    2022-12-06   118
# ℹ 7 more rows</code></pre>
</div>
</div>
</div><div class="column" style="width:60%;">
<ul>
<li>New observations are created on the missing dates</li>
<li>NAs are filled in for the missing FCPs, with one for each day and group (pat_id)</li>
<li>we used <strong>tidyr::fill(pat_id)</strong> to fill in the missing pat_ids</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="joins-of-data-from-different-sources" class="level2">
<h2 class="anchored" data-anchor-id="joins-of-data-from-different-sources">Joins of data from different sources</h2>
<ul>
<li>We often collect data from different sources that we later want to join together for analysis
<ul>
<li>Data from local Electronic Medical Record</li>
<li>Data from the CDC</li>
<li>Data from the US Census</li>
</ul></li>
<li>External data can illuminate our understanding of our local patient data</li>
</ul>
</section>
<section id="local-demographics-with-cdc-svi-data" class="level2">
<h2 class="anchored" data-anchor-id="local-demographics-with-cdc-svi-data">Local Demographics with CDC SVI data</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true" href="">The Problem</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false" href="">The Data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false" href="">The Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-4" role="tab" aria-controls="tabset-8-4" aria-selected="false" href="">The Result</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>We have 2 datasets, one local Demographics and Census Tract, and one from the CDC that has values for Social Vulnerability Index by Census Tract</li>
<li>We want to know the median SVI for the neighborhood of each patient</li>
<li>We need to left_join these datasets together by matching on the Census Tract</li>
</ul>
</div><div class="column" style="width:40%;">
<p><img src="images/joins.PNG" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<ul>
<li>What is the common uniqid/key?</li>
</ul>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li>demo</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  pat_id name                 htn census_tract
  &lt;chr&gt;  &lt;chr&gt;              &lt;dbl&gt;        &lt;dbl&gt;
1 001    Arthur Blankenship     0  26161404400
2 002    Britney Jonas          0  26161405100
3 003    Sally Davis            1  26161402100
4 004    Al Jones               0  26161403200
5 005    Gary Hamill            1  26161405200
6 006    Ken Bartoletti         0  26161404500
7 007    Ike Gerhold            0  26161405600
8 008    Tatiana Grant          0  26161404300
9 009    Antione Delacroix      1  26161405500</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<ul>
<li>cdc</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  census_tract   svi
         &lt;dbl&gt; &lt;dbl&gt;
1  26161404400  0.12
2  26161405100  0.67
3  26161402100  0.43
4  26161403200  0.07
5  26161405200  0.71
6  26161404500  0.23
7  26161405600  0.27
8  26161404300  0.21
9  26161405500  0.62</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<ul>
<li>Replace the generic arguments to the left_join function to join the demographic data (<em>demo</em>) on the left to add Social Vulnerability index (svi) from the <em>cdc</em> dataset on the RHS. Left join by census tract.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(dataset_x, dataset_y, <span class="at">by =</span> <span class="st">"key"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-8-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-4-tab">
<ul>
<li>Is there an association between social vulnerability and hypertension?</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 5
  pat_id name                 htn census_tract   svi
  &lt;chr&gt;  &lt;chr&gt;              &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt;
1 001    Arthur Blankenship     0  26161404400  0.12
2 002    Britney Jonas          0  26161405100  0.67
3 003    Sally Davis            1  26161402100  0.43
4 004    Al Jones               0  26161403200  0.07
5 005    Gary Hamill            1  26161405200  0.71
6 006    Ken Bartoletti         0  26161404500  0.23
7 007    Ike Gerhold            0  26161405600  0.27
8 008    Tatiana Grant          0  26161404300  0.21
9 009    Antione Delacroix      1  26161405500  0.62</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="patient-demographics-with-lab-results-your-turn-to-join" class="level2">
<h2 class="anchored" data-anchor-id="patient-demographics-with-lab-results-your-turn-to-join">Patient Demographics with Lab results (Your Turn to Join)</h2>
<div class="columns">
<div class="column" style="width:40%;">
<ul>
<li>We have some basic Patient Demographics in one table</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 3
  pat_id name                 age
  &lt;chr&gt;  &lt;chr&gt;              &lt;dbl&gt;
1 001    Arthur Blankenship    67
2 002    Britney Jonas         23
3 003    Sally Davis           63
4 004    Al Jones              44
5 005    Gary Hamill           38
6 006    Ken Bartoletti        33
7 007    Ike Gerhold           52
8 008    Tatiana Grant         42
9 009    Antione Delacroix     27</code></pre>
</div>
</div>
</div><div class="column" style="width:60%;">
<p>and potassium levels and creatinine levels in 2 other tables</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  pat_id     k
  &lt;chr&gt;  &lt;dbl&gt;
1 001      3.2
2 002      3.7
3 003      4.2
4 004      4.4
5 005      4.1
6 006      4  </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  pat_id    cr
  &lt;chr&gt;  &lt;dbl&gt;
1 001      0.2
2 002      0.5
3 003      0.9
4 004      1.5
5 005      0.7
6 006      0.9</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="your-turn-to-join" class="level2">
<h2 class="anchored" data-anchor-id="your-turn-to-join">Your Turn to Join</h2>
<ul>
<li>We want to join the correct labs (9 rows each) to the correct patients.</li>
<li>The unique identifier (called the uniqid or key or recordID) is pat_id.</li>
<li>It only occurs once for each patient/row</li>
<li>It appears in each table we want to join</li>
<li>The pat_id is of the character type in each (a common downfall if one is character, one is numeric, but they <strong>look</strong> the same - but don’t match)</li>
<li>We want to start with demographics, then add datasets that match to the right.</li>
<li>We will use <em>demo</em> as our base dataset on the left hand side (LHS), and first join the potassium (<em>pot</em>) results (RHS)</li>
</ul>
</section>
<section id="what-the-left-join-looks-like" class="level2">
<h2 class="anchored" data-anchor-id="what-the-left-join-looks-like">What the Left Join Looks Like</h2>
<div class="animations">
<img alt="gif here" width="80%" height="80%" src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/main/images/left-join.gif">
</div>
</section>
<section id="your-turn-to-join-1" class="level2">
<h2 class="anchored" data-anchor-id="your-turn-to-join-1">Your Turn to Join</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true" href="">The Problem</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false" href="">The Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false" href="">The Result</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<ul>
<li>Joining <em>demo</em> to <em>pot</em> with a left_join</li>
<li>left_join(data_x, data_y, by = “uniqid”)</li>
</ul>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<ul>
<li>replace the arguments with the correct ones to join <em>demo</em> to <em>pot</em> and produce <em>new_data</em>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(data_x, data_y, <span class="at">by =</span> <span class="st">"uniqid"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>new_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  pat_id name                 age     k
  &lt;chr&gt;  &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt;
1 001    Arthur Blankenship    67   3.2
2 002    Britney Jonas         23   3.7
3 003    Sally Davis           63   4.2
4 004    Al Jones              44   4.4
5 005    Gary Hamill           38   4.1
6 006    Ken Bartoletti        33   4  
7 007    Ike Gerhold           52   3.6
8 008    Tatiana Grant         42   4.2
9 009    Antione Delacroix     27   4.9</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="exercise-ph2" class="level2">
<h2 class="anchored" data-anchor-id="exercise-ph2">Exercise PH2</h2>
<p><br></p>
<p>Complete Data Cleaning Fundamentals Exercise PH2.</p>
<p><a href="https://shannonpileggi.github.io/rmedicine-data-cleaning-2023/exercises.html" target="_blank">–&gt; Take me to the exercises &lt;–</a></p>
<ul>
<li><p>If you have the exercise done correctly, click on the Reactions tab in Zoom, and click to put the “thumbs up” emoji 👍 on your screen.</p></li>
<li><p>If you are having trouble, click on the Reactions tab in Zoom, and click to put the “raised hand” emoji ✋ on your screen.</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_16f51dbc" data-update-every="1" tabindex="0" style="right:0;bottom:0;font-size:4em;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
<section id="solution-ph2" class="level2">
<h2 class="anchored" data-anchor-id="solution-ph2">Solution PH2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(demo, pot, <span class="at">by =</span> <span class="st">"pat_id"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>new_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="now-add-creatinine-cr-to-new_data" class="level2">
<h2 class="anchored" data-anchor-id="now-add-creatinine-cr-to-new_data">Now add Creatinine (cr) to new_data</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true" href="">The Problem</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false" href="">The Code</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false" href="">The Result</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<ul>
<li>Joining new_data and cr with a left_join</li>
<li>left_join(data_x, data_y, by = “uniqid”)</li>
</ul>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<ul>
<li>Replace the generic arguments with the correct ones to join new_data and cr and produce new_data2.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>new_data2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(data_x, data_y, <span class="at">by =</span> <span class="st">"uniqid"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>new_data2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 5
  pat_id name                 age     k    cr
  &lt;chr&gt;  &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 001    Arthur Blankenship    67   3.2   0.2
2 002    Britney Jonas         23   3.7   0.5
3 003    Sally Davis           63   4.2   0.9
4 004    Al Jones              44   4.4   1.5
5 005    Gary Hamill           38   4.1   0.7
6 006    Ken Bartoletti        33   4     0.9
7 007    Ike Gerhold           52   3.6   0.7
8 008    Tatiana Grant         42   4.2   1  
9 009    Antione Delacroix     27   4.9   1.7</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="exercise-ph3" class="level2">
<h2 class="anchored" data-anchor-id="exercise-ph3">Exercise PH3</h2>
<p><br></p>
<p>Complete Data Cleaning Fundamentals Exercise PH3.</p>
<p><a href="https://shannonpileggi.github.io/rmedicine-data-cleaning-2023/exercises.html" target="_blank">–&gt; Take me to the exercises &lt;–</a></p>
<ul>
<li><p>If you have the exercise done correctly, click on the Reactions tab in Zoom, and click to put the “thumbs up” emoji 👍 on your screen.</p></li>
<li><p>If you are having trouble, click on the Reactions tab in Zoom, and click to put the “raise hand” emoji ✋ on your screen.</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div class="countdown" id="timer_5529f487" data-update-every="1" tabindex="0" style="right:0;bottom:0;font-size:4em;">
<div class="countdown-controls"><button class="countdown-bump-down">−</button><button class="countdown-bump-up">+</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">03</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
</div>
</div>
</section>
<section id="workhorse-joins" class="level2">
<h2 class="anchored" data-anchor-id="workhorse-joins">Workhorse Joins</h2>
<ul>
<li><em>left_join</em> is your workhorse. Start with patient identifiers/uniqid and add data to the right side.</li>
<li>Sometimes you will need to wrangle/process incoming data, then <em>right_join</em> it to the patient demographics</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="animations">
<img alt="gif here" width="100%" height="100%" src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/main/images/left-join.gif">
</div>
</div><div class="column" style="width:50%;">
<div class="animations">
<img alt="gif here" width="100%" height="100%" src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/main/images/right-join.gif">
</div>
</div>
</div>
</section>
<section id="fancy-joins" class="level2">
<h2 class="anchored" data-anchor-id="fancy-joins">Fancy Joins</h2>
<ul>
<li>There are multiple kinds of fancy joins (semi_join, anti_join, inner_join, full_join, union, intersect, setdiff) which come in handy once in a while.</li>
<li>These are all well explained <a href="http://statseducation.com/Introduction-to-R/modules/tidy%20data/joins/#:~:text=semi_join(x%2C%20y)%3A%20Return,This%20is%20a%20filtering%20join.">here</a></li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="animations">
<img alt="gif here" width="100%" height="100%" src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/main/images/semi-join.gif">
</div>
</div><div class="column" style="width:50%;">
<div class="animations">
<img alt="gif here" width="100%" height="100%" src="https://raw.githubusercontent.com/gadenbuie/tidyexplain/main/images/anti-join.gif">
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>